#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>

/* Put your SSID & Password */
const char *ssid = "NaeemGlasses";  // Enter SSID here
const char *password = "123456789"; // Enter Password here

/* Put IP Address details */
IPAddress local_ip(192, 168, 1, 1);
IPAddress gateway(192, 168, 4, 1);
IPAddress subnet(255, 255, 255, 0);
ESP8266WebServer server(80);

/*-------------------------*/
uint8_t glassPin = 2;
uint8_t glassStatus = 0;
int ledState = LOW;
int interval = 83;
int previousMillis = 0;
/*-------------------------*/
void setup()
{
  Serial.begin(115200);
  pinMode(glassPin, OUTPUT);
  Serial.print("Setting soft-AP ... ");
  WiFi.mode(WIFI_AP);
  WiFi.softAPConfig(local_ip, gateway, subnet);
  WiFi.softAP(ssid, password);
  //  wifi_set_sleep_type(LIGHT_SLEEP_T);
  server.on("/", handle_OnConnect);
  server.on("/glassOn", handle_glassOn);
  server.on("/glassOff", handle_glassOff);
  server.on("/glassOnTimer", handle_glassOnTimer);
  server.on("/glassOffTimer", handle_glassOffTimer);
  server.onNotFound(handle_NotFound);
  // added
  server.on("/setInterval", handle_setInterval);

  server.begin();
}

void loop()
{
  unsigned long currentMillis = millis();
  server.handleClient();
  if (glassStatus == 0)
  {
    digitalWrite(glassPin, LOW);
  }
  else if (glassStatus == 2)
  {
    if (currentMillis - previousMillis >= interval)
    {
      // save the last time you blinked the LED
      previousMillis = currentMillis;

      // if the LED is off turn it on and vice-versa:
      if (ledState == LOW)
      {
        ledState = HIGH;
      }
      else
      {
        ledState = LOW;
      }

      // set the LED with the ledState of the variable:
      digitalWrite(glassPin, ledState);
    }
  }
  else
  {
    digitalWrite(glassPin, HIGH);
  }
}

void sendStatus()
{
  sendStatus();
}

void handle_OnConnect()
{
  glassStatus = 0;
  server.send(200, "text/html", SendHTML());
}

void handle_glassOn()
{
  glassStatus = 1;
  sendStatus();
}

void handle_glassOnTimer()
{
  glassStatus = 2;
  sendStatus();
}
void handle_glassOffTimer()
{
  glassStatus = 0;
  sendStatus();
}
void handle_glassOff()
{
  glassStatus = 0;
  sendStatus();
}

void handle_getStatus()
{

  // server.on("/getGlassStatus", HTTP_GET, []() {
  sendStatus();
  // server.send(200, "text/plain", glassStatus);
}

void handle_setInterval()
{
  if (server.hasArg("value"))
  {
    previousMillis = millis();
    interval = server.arg("value").toInt();
    sendStatus();
  }
  else
  {
    server.send(400, "application/json", String("{\"error\":") + "Didnt send value" + "}");
  }
}

void handle_NotFound()
{
  server.send(404, "text/plain", "Not found");
}

String SendHTML()
{
  String ptr = "<!DOCTYPE html>\n<html>\n  <head>\n    <meta\n      name='viewport'\n      content='width=device-width, initial-scale=1.0, user-scalable=no'\n    />\n    <title>LED Control</title>\n    <style>\n      html {\n        font-family: Helvetica;\n        display: inline-block;\n        margin: 0px auto;\n        text-align: center;\n        background: #fff;\n        color: #3f3f3f;\n        -webkit-font-smoothing: antialiased;\n        overflow-x: hidden;\n      }\n      body {\n        margin: 0px;\n        counter-reset: card-count;\n        overflow-x: hidden;\n      }\n\n      p {\n      }\n\n      * {\n        user-select: none;\n        -webkit-tap-highlight-color: transparent;\n      }\n\n      *:focus {\n        outline: none;\n      }\n\n      .button {\n        position: relative;\n        top: 50%;\n        width: 80px;\n        height: 40px;\n        margin: 0 auto 0 0;\n        overflow: hidden;\n      }\n\n      .button.r,\n      .button.r .layer {\n        border-radius: 100px;\n      }\n\n      .checkbox {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        padding: 0;\n        margin: 0;\n        opacity: 0;\n        cursor: pointer;\n        z-index: 3;\n      }\n\n      .knobs {\n        z-index: 2;\n      }\n\n      .layer {\n        width: 100%;\n        background-color: #ebf7fc;\n        transition: 0.3s ease all;\n        z-index: 1;\n      }\n\n      /* Button 3 */\n      .toggle .knobs:before {\n        content: attr(data-on);\n        position: absolute;\n        top: 4px;\n        left: 4px;\n        width: 24px;\n        height: 12px;\n        color: #fff;\n        font-size: 10px;\n        font-weight: bold;\n        text-align: center;\n        line-height: 1;\n        padding: 9px 4px;\n        background-color: #03a9f4;\n        border-radius: 50%;\n        transition: 0.3s ease all,\n          left 0.3s cubic-bezier(0.18, 0.89, 0.35, 1.15);\n      }\n\n      .toggle .checkbox:active + .knobs:before {\n        width: 46px;\n        border-radius: 100px;\n      }\n\n      .toggle .checkbox:checked:active + .knobs:before {\n        margin-left: -26px;\n      }\n\n      .toggle .checkbox:checked + .knobs:before {\n        content: attr(data-off);\n        left: 42px;\n        background-color: #f44336;\n      }\n\n      .toggle .checkbox:checked ~ .layer {\n        background-color: #fcebeb;\n      }\n\n      .knobs,\n      .layer {\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        left: 0;\n      }\n\n      .hr-line {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        white-space: nowrap;\n        &:after,\n        &:before {\n          content: '';\n          background-color: #666;\n          height: 1px;\n          width: 100%;\n          margin: 12px;\n        }\n      }\n\n      .output {\n        position: relative;\n        width: 40px;\n        padding-top: 10px;\n        height: 32px;\n        margin-left: 50%;\n        font-family: cursive;\n        font-size: 16px;\n        line-height: 20px;\n        color: #6441a5;\n        text-align: center;\n        background: #f5f9ff;\n        border: 2px solid #6441a5;\n        border-radius: 50% 50% 50% 0%;\n        -webkit-transition: opacity 0.3s ease-in-out 0s;\n        transition: opacity 0.3s ease-in-out 0s;\n      }\n\n      .range {\n        --active: #5628ee;\n        --value: #fff;\n        --line: #cdd9ed;\n        touch-action: none;\n        -webkit-appearance: none;\n        appearance: none;\n        user-select: none;\n        width: 320px;\n        height: 2px;\n        border-radius: 1px;\n        background: var(--line);\n        position: relative;\n      }\n      .range::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 15px;\n        height: 15px;\n        background: #f5f9ff;\n        border: 2px solid #6441a5;\n        cursor: pointer;\n        border-radius: 18px;\n        transition: 0.5s ease;\n      }\n      .range::-webkit-slider-thumb:focus,\n      .range::-webkit-slider-thumb:active {\n        padding: 8px;\n      }\n      .range:focus,\n      .range:active {\n        outline: none;\n      }\n\n      .output {\n      }\n\n      .row {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 16px;\n      }\n\n      .row label {\n        margin: 0 0 0 auto;\n      }\n\n      .slider {\n        width: 320px;\n        margin: auto;\n      }\n\n      .number {\n        width: 64px;\n        margin: 0 auto 0 0;\n        padding: 4px;\n      }\n\n      .card {\n        margin: 8px 12px 0 12px;\n        padding: 16px 8px;\n        background-color: #fff;\n        box-shadow: 0 10px 20px -8px #c5d6d6;\n        border-radius: 4px;\n        position: relative;\n      }\n\n      .card:before {\n        counter-increment: card-count;\n        content: counter(card-count);\n        position: absolute;\n        top: 0;\n        left: 0;\n        color: #d7e3e3;\n        color: #a0a0a0;\n        font-size: 12px;\n        font-weight: bold;\n        padding: 4px 8px;\n        border-radius: 50%;\n        /* background: #a0a0a0; */\n        margin-left: 2px;\n      }\n\n      .checkbox:disabled + .knobs {\n        opacity: 0.8;\n        filter: grayscale(1);\n      }\n\n      .stopwatch {\n        background-color: #f0f2f2;\n        box-shadow: 0 10px 20px -8px #c5d6d6;\n        padding: 20px 24px;\n        border-radius: 20px;\n        margin: 8px auto;\n      }\n\n      .timerDisplay {\n        font-size: 24px;\n        font-weight: 700;\n      }\n\n      .hidden {\n        display: none;\n      }\n\n      .card.active {\n        border: #4fd93e 1.6px dashed;\n      }\n\n      .progress-bar {\n        top: 0;\n        position: fixed;\n        height: 4px;\n        background-color: rgba(5, 114, 206, 0.2);\n        width: 100%;\n        overflow: hidden;\n      }\n\n      .progress-bar-value {\n        width: 100%;\n        height: 100%;\n        background-color: rgb(5, 114, 206);\n        animation: indeterminateAnimation 1s infinite linear;\n        transform-origin: 0% 50%;\n      }\n\n      @keyframes indeterminateAnimation {\n        0% {\n          transform: translateX(0) scaleX(0);\n        }\n        40% {\n          transform: translateX(0) scaleX(0.4);\n        }\n        100% {\n          transform: translateX(100%) scaleX(0.5);\n        }\n      }\n    </style>\n  </head>\n  <body>\n    <img\n      style='width: 102px; margin-top: 12px'\n      src='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAkACQAAD/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAEAAAAAAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooJxX4U/8Fev+CtP7Rv7Nn/BSP4peB/A/wAUr/w/4T8Pz6Yun6dHoul3C2wl0ixuJAHmtXkbdLLI3zMcbsDAAA9jI8kr5pXeHoNJpc3vXtZNLonrqY1q0aUeaR+61FfzK/8AD+D9rX/otmpf+E9on/yFSr/wXf8A2tncKPjZqRZjgD/hHtF5/wDJKvqf+Ib5j/z8p/fL/wCQOb+0KfZn9NNFfzLP/wAF3v2to3Kt8bNSDL1H/CPaLx/5JUn/AA/h/a1/6LZqX/hPaJ/8hUf8Q3zH/n5T++X/AMgH9oU+zP6aqK/D/wD4Ivf8FWP2h/2of+CiHg3wX4++J194k8K6lZ6lLd6fJo2mW6zNFZSyRkvBbJINrqp4YZxg5HFfuAGzXy2dZLWyzELD12m2k9L2s7rql27HVRrKpHmiFFFFeOahRRRQAUUUUAFc78W/itoPwM+GWu+MfFWoDSvDfhqyk1DUrwwyTC2gjUs77I1Z2wB0VSfauir55/4K0f8AKMz46/8AYl6l/wCiGrowtFVa8KUtpNL73YmcrRbPyH/4OKv25vhB+3pq3wXl+GXie38YJ4Sh15dTP9l3Vr9jNydMMI/0iKPdv+zy/czjZzjIz85fs9f8Eh/2iv2jvhXofjjwD8MZNb8H6yzvYX0eu6TarMsU7xSYimukkXEkcg+ZBnbkZBBPqv8AwRl/4JQ+F/8Agp3b/EhvEfizxH4XbwS+mLb/ANlxwOLkXQuy2/zUb7v2dcYx945zxj94f2J/2VNN/Yj/AGY/DHww0fVdQ1zTfC63Kw318qLcT+ddTXJ3BAF4aYqMDoB3r9WzTPqGQYaOV5e+adN6qab0leV7rlTd2vkeZToOvL2tTZ9j1XpX4j/8Fxv+C4zfFF9Y+C3wV1pl8MqXs/FPimxlx/bJGQ9jZyKf+Pbqssyn99yinytzS/XH/BxH4o+OHhv9i6Zvhbb7fBcwmTx9f6fI/wDa9np+0Y2IB8to3zi4kUl1TbkCIzOv48/8EkvC3wV8V/tu+FLH45XUlv4VZx/ZtvKijSr7Ut6fZ4b9ycrbE5+XGx32LIRGXVvG4QyXDrDyzjEfvPZ3tBau66td+y+Zri60uZUo6X6n2l/wQ3/4Lht8NpNH+Cvxp1pn8OMUsvCvii+lydJJwqWF3Ix/49+ixTMf3XCMfL2tF+2lfy3/APBVvwx8FfCf7avi6x+Bl5Ld+DI5D9tiRVbTLPUNzfaYbCQEmS1U4xkbVbesZaIJj9nv+DfHVvjlqn7Elm3xah/4pdRCPAdxqDv/AG1c6ZtPM6kf8ew+T7O7nzGjyceX5LuuMMlw/sI5vh/3ftLXg9Hd9Uu/dfMMJWlzeylrbqfir8eP+CR/7Qv7KnwRuPGPxK+GMnh7wrpP2aC8vJdc0q8WF5ZEhjHlwXUkjZkdFyqkDOTgZNfVH/Buv+3Z8Hf2DE+MX/CzPFNv4P8A+EqbRTpuNLu7r7X9nF/5v/HvDJt2+fH97Gd3GcHH7Jft4/sc6V+3t+zPrXwx1rWtU0DTdauLO4kvdPSNriM21zHcKFEgK/M0YByOhPevwj/4LOf8ErvDP/BMG/8AhnD4b8VeIvFA8dR6s9ydVjgj+y/YzYhNnlKv3vtb53Z+4uMc59zK8+oZ/hnlmYPlqVHooJrSKUr3fMr6MxqUJUJe0hql3+4/oK/Z6/aF8H/tU/CLS/HngLWF17wnrbTrY34tprYTmCeS3l/dzIki7ZYpF+ZRnbkZBBPaV8Xf8G9P/KIT4T/9dtd/9Puo19o1+WZlho4fF1cPDaEpRV97Jtanp05c0FJ9UFFFFcRYUUUUAFfPP/BWj/lGZ8df+xL1L/0Q1fQ1fPP/AAVo/wCUZnx1/wCxL1L/ANENXZlv+90v8UfzRnV+B+h+fX/BpecWnx9/66eH/wCWpVlf8F0f+C3x8QPrXwQ+DGsbbFC9j4t8UWUv+vPKyafZyKfu9VmmU88xqfvmvkP9ha8+OWk/sCftFXHwYhka0nutGi8Y3GnyN/bVrpSw6gXNoijJU7iJXQ+akYOxTlnj5n/gkFYfA3UP22vCkXx0dh4VLL/Y8cwT+xZtT3L9nXUST/x69eP9Wz+WJT5O8N+wVsmw7zPFZtiF7T2drQWruoRd2vyXzPKjWl7ONKOl+vzPtD/gh1/wW7HgVNH+B/xp1RZPDsuzT/Cvia9fP9nZwsen3jt1gPCxTN/q+Ec7NrR/HP8AwWL8AfBP4bftyeJ9H+B9w7aDbsV1qwgRTpOk6oHYT21i4PMK8bo8bIpN6I20COLD/wCCqenfBLSP21PF0PwHuJp/BCSf6UI9p0qLUNz/AGlNOYHLWQO3aSNm7zBETAIjV7/gkdYfA/Uv22/CcXx2kdfCRcf2ZHME/sebUtyfZl1Ek8WhOcjHls/liU+T5gPoYXAYfDSlneHjOKlC7ppbvfbv/wAP3vnKpKSVF20e5sf8EZvD3wN8S/tweHbP45szaTIyL4ftrpU/sW81TePJjvyf+WZ/gQjy3k2rIdp2P9Z/8FxP+C4rfFb+2fgr8F9Yx4VXzLHxT4qs5P8AkN9VksrNx/y69VkmX/Xcoh8rLTfFn/BV/T/gjpf7a/iyH4DzSTeC1c/bVjCf2TFqO5/tK6cwOWswdu3PyB/MERMPlVN/wSXsfgjqH7bvhSL48SSR+ETIP7PScJ/ZEupb0+zrqRPItCd2R9wv5YlIh80FYrL8PiJRzyvGcuWF1Ta2e+3f9dew41JRXsY233Pvj/ghN/wW4KNovwM+M2sZZjHYeD/E97L/AKzosenXcjfx9FhlY/NxGx37C9f/AIO1Odc/Z4/64eJ//QtGr4J/4Kzad8D7H9tbxdB8CpJJvBm8jUEjVDo8eo7n+0rpxBybMHGMjYH8wREw+Vjpv2+fGfxu8b/sYfsxXXxnt5GjWLxGvhHUL+R/7Y1TScaNslvFYZ44EUrHzJY8M69JZuDD5LQWaYbNsOvZqpzXg9Hdwk7pfmvmW60vZSpS1t1+Z+y//BvT/wAohPhP/wBdtd/9Puo19o18Xf8ABvT/AMohPhP/ANdtd/8AT7qNfaNflOff8jPEf9fJ/wDpTPUofw4+iCiiivJNQooooAK+ef8AgrR/yjM+Ov8A2Jepf+iGr6Gr55/4K0f8ozPjr/2Jepf+iGrsy3/e6X+KP5ozq/A/Q+Bf+DTb/kV/jp/1+6J/6Lva5n/guP8A8EN/+EV/tr41fBXRc6Wd974r8KWUP/Hp/FJf2Ua/wdWlgUfLy6DG5R03/Bpt/wAiv8dP+v3RP/Rd7X7AEZr7DOs4xGW8Q1q+Hf8ALddGuWOj/R9Dlo0Y1MOoyPxW/wCCDv8AwRT/AOEyfQ/jt8X9IRtFAi1DwZ4du0z9uPDxalcp08v7rQRt9/IkIwI93yR/wW21n4G69+3Lr03wSjxbkuPFM9mU/sW61XefNeyA/HzWX928mSgzvZ/2M/4Ltn45/wDDD+qQfBW1Nxb3BeLxd9gDtra6WUw4slUc55EpX94I87BnLL+Jn/BIuy+B+pfts+Eo/jpIy+ESynS0lCf2NNqW5Psy6iT0tDzxjyy/liU+T5gP03D+Mr4uVbPsRNy5U0qcHeyWtmvy7u78jmxEIwtQivmy3/wSC8cfBL4d/tueG9S+Olj53hyMgaVeXLqdJ0rUty+TcX8ZHzQrzhydkT7XdSgMkX1d/wAFxf8AgiSvwRGrfGz4M6WsngGbdfeJvDlkm4eG85Z721Rf+XE/ekjX/j35Zf3GRb/H/wDwVesvgjpP7bPiyP4DzSSeC0c/bRFs/smHUdz/AGldNYHJswdu3+AP5giJg8qv2M/4N4fC/wAbtG/Yojh+Ksi/8IRMIj4CsdRjc6vb6cVO4SFjxZn5Ps8bjeqF8EQmFRtn2OrYT2We0JuPMknTnpdPWyXRrd/f3TWHpqd6Ml80fJv/AAQ3/wCCHf8Awsn+x/jT8adF/wCKbGy98K+Fr6L/AJC3Ro768jYf8e/RooWH73h2Hl7Vk3P+DtQf8Tv9nj/rh4n/APQtGr9mAMV+M/8Awdqn/iefs8f9cPE//oWjV8vkOcYjMuI6Neu/5rLpFcktF+r6nVWoxp4dxj5fmfY//BvT/wAohPhP/wBdtd/9Puo19o18Xf8ABvT/AMohPhP/ANdtd/8AT7qNfaNfK59/yM8R/wBfJ/8ApTOmh/Dj6IKKKK8k1CiiigArx/8Ab/8AhJq/x8/Yq+J3gnQTZrrHizw/daVaSXk3k28LzJs8yV+dsaZ3MQCdqnAJwD7BXgf/AAUJ/aK8Ofs9fDjwavi7ULbR/DPjrxppnhfU9QumVLW1tpvMnlE7N8qwSpbtBIzEKqTsxIAJrqwUajrw9iryTTXy1/QmduV32PjD/gn38J7f/gjFpnxQtbe68RfGq48dnQ/+ET07w/oJtdX16/W2u5p7UWjSyGBIbea1uJLiVljjiuowx80eWf0y+Hmt6t4j8AaHqGv6MPDuvX+nwXOo6St2t4NLuXjVpbfzlAWXy3LJ5igBtuQADivy/wD2XtR8eeP/ANpb4PX2rfFTw42pWPhjxBafF/wp4fv4NXSzGp6heTpcxX9s0kcEl9fS6YsFtG8VyFt1EYkSKRVoeM/2O9a8U+IfC/jzwn46/bKvPhN8QtK8NWfhvSfCHxF1LUNR+2ajLO9xql1c3kkq21nBYLaTsZT5ZuJ2jDoiha+mzLCLE4hyxVVc7SblbRte6lb3UtI8ysmmnfmSOenLljaK0P1n3Z9fyr+Zb/gtTrXwT1f9uvxRJ8FbY2+mxMyeJJ7ZkXR7rVg7faHskA+VO0jA7HlDsigZeT1T4wfsL/t9+HPiP4r8P6Rq37RHi7wzp+p3mnWOqHxtcxw63ZpK8cdwYmvjtWaMBtjZwHxzX1P/AMEX/wDggXJ8KdW034rfHbR7YeIrGQTeHfBs3lzRaQyH5Ly82lo5JxjdFECyxfK7Ey7Vg97J6OCyFSzCeJVRtWjCD3b11V3t57etkYVnOt+7UbebPzu/4JB3nwQtv24PCrfHaPzPC7n/AIlMlyyf2PFqe5PszaipHNt97nOxZPLMoMW8r/T8p471+QP/AAWn/wCCCupfEDxdffFf4D6Gt9qut3Jm8S+EYHSL7XNI3z31pvKoGZmLTREgNkyL825X+VvDf7CP7c9v4TuLOz8aeOtL1/RLGK5tvAafFCaPxFJpqyLbi5gsY7kpHao2EG94yQuEVgBWmb0MDn3s8dDFKm7WcZPZ+Sureb2ejJpSnQvBxv5o/opzX4z/APB2qP8Aiefs8f8AXDxP/wChaPVL/gnr+x58SNc+Jl1o/wAYPil8avHPiextjNrfhHw38SNWW28CW5Xdv1a/tbjB1JwP9H023d3Ysskv7osY/kr4l/8ABM39tT4w3du3ijwF8YfFkOmtKNO/4SPxBHqU1kkhXcFMlywRmCR79mAxReuBjn4bynC4LNFXniY2p97RUuaMl7rb1tve1rWs2ncvEVZzp25Xr+h+xP8Awb0/8ohPhP8A9dtd/wDT7qNfaNfK/wDwRR+Cniz9nb/gmd8OfB3jjQ7zw34o0iXWDeaddMjTW4l1i9mjyUZl+aKSNxgnhh34r6or4jOqkZ5jXnB3TnNprZrmex2UbqnFPsgooorzDQKKKKACvP8A9pz9lvwL+2N8I73wN8RdBi8Q+G76WOdrczy28kUsbbo5YpYmWSN1P8SMMqWU5VmB9Aoq6dSdOanTbTWqa0afdMTSasz4itv2D7P9hiWzX4X6GD4HsbiKTw34C0TSbiebX/EkissOp+INVlkld7O1P7xN/lxQFEceZNHbRjM/Zb+MGufszftS/FXw14x+IXg3Sf2c/gj4N8N+FtGmuNStkg027jgEYW6nIXy75wjtJblyyxy2R2/OjP8AbfjfxppHw58KX2u69qFppOkaXEZ7q8uZBHFAg7kn8gOpJAGScV8WeLf2ZfgP8Kv2bNY+LXxo+Hfh3Qfhf4JsrnUdA8D3elINP8OWsvym5lsSBHPrV67qzySqZIWljgQhxPNce7hcY8QpRxV5OVo3teTd09Nry3V3d2k7t6J5Sha3L0/r7j3rRf8Agpf+zr4g09bq1+O/wfaJhkiTxfYROn+8jyhl/ECuI+MP/Baz9lr4KaZJcal8aPBurMgO2Hw/cNrkkjdlH2MShSemWKqO5A5ri9O/4IN/sf8AxF0+016P4P3VrHq8Md6kL6/rumtEsihwrW32pPJYAjMZRSpyCAQRXtPwG/4Jr/AX9mXU7XUPBPwn8F6Pq1mwe31NrBbvUYD6pdT75l/Bxmpksmjqvay8moR/G8v/AEkF7Z9vxPA9U/bS+L37XHga98R+H9D1L9mX4H2kSzX3j7xjZxyeLNVt2IAXSdJxJHC8hISOe487zPPj8qCR8LWl+z3+xhr3i/Qr630ez8RfAv4b+Ipo7vV5jfyTfE74kuA3+k6vqrO01grhjiNHe8CMB5tiQ1uNb/gob/wUr+HP7HvxU+Ei+Ltctl8ParLrmoyTWm+8U3lhbiCG3lWFZGVTPcsN2w7JYEJwEYix+yD+17rXxQ+Hnjj4xeP/ABz4fs/gKtov9iapqPht/C8Nwis3n30bXNw8v2Eq0UUTziOWaRZnEaRmHzN5LERw3tqNL2cJfDu7u9rXafNO6b1em8VElOLlyt3f9fgVf2H7PQ/GfxTt5fAOtWPwv8A/CG21TRZ/hZo8thMuoNcXsiW2uajJDI7L58dnNJHHIqzbzJI0rB3V7X7Rf/BS63PinS/BfwstrzxNr/iJPMsb3TbJdQur6HODLpdmzxrdR9FOoXEtvpcJfLXU0kbWrcL4A+Gc/wAefh1H4T+Cfw+8O/s5/s/3Utqk/inVfDcFvrvi8Lsggaw0q4j2IGVY1S71VJJGLRMlq5CSj6u/Zy/ZP8Efss6FfWvhPTJhqGtyrc65rmo3Umoa14iuFBAnvb2YtNcSDJA3sVQHagRQFGGKlQhVdSsuZ9I6adffeut3ezcn0lYqPM1Zf16HOfs9fCb4iajqeleLvirrq/2vp1n9m0vwzptz51jpO5Qr3F3cBI/t+oOuQ0oihgiDskMI+eab2uiivFqVHOV2kvJbL0/r11NUrBRRRWYwooooAKKKKAMnxD4F0fxZqml3mqafa6hcaLMbmwNwnmLaT9BMin5RKoyFkxvUM4UgOwOqyK6FWG5SMEHvS0UAH3RX5x/8FFf23viV+1fawfCz9lPwPrnxEzrYtPFPiySynt/CDxQsyzaYNQEkKzAyBRcGCXAiWSIF2kZU+1P2n9QmuPAdh4btria3ufHGr2nh/MMjRSm2lffe7JFIaOT7DFdlXU7kYKw5Ga7jRvDdn4W8M2mk6PZ2Ok2Gm2yWlja21usdtZRIoWONI12qqIoUBVwAAAMCvQwOIp4aSxE4c8uie2nVpavyV1qupnUi5LlufHvw+0v9lvwvqniLwD4E+GPwp1DXo/iFpXhrxHo9l4at7awGsCzNw00atGyYtrNb50VMhZIp48q7SMa3xS+NHhLxT+2j4f1D4jeGfEV58LPDljd6v4R8Ram1lb+DtKubCNGuNVe3af7RPIGlWGC9mhEEe6H7Lk3DzScJp37AHgP9qj4D6n8O/C37Rlnqnxs0PxLpnxE1/wAf+D7e1guf7TFtcaZbzyQWkwEYaCC4XaLjzPNV5XYmQh/c/wBi3/gkd8Kf2OLKzvfs198QPGdvKbo+JfFMgvrqCcyGUtaxsPKtB5rO48pQ+WJZ3JLH1q08JS5pzqTlO1rNSvql7yk7WT6aN20aszKKk9Elb+tDivjX8ZvH37Svga68ew/DbxN8N/hz8IbfUPG9lc+Lf9C1zxTqNjY3i2sK6UpLwWqTMtwXu2SRzBCFg2v5i+vfswftOaZr3xw8XfAddP12PxB8F/DugHUdSvVJh1Rru2c5idvmkCCJd0h4dnYAko1ejfGH4QyfGFdFsbrWr6w8P2N/Hf6nptqqL/b3lMHitp5GBYWvmKHkjTaZgixu3ktLFLh/s7fAjWPhrqfiLxR4y8RW/i74geMHhXU9RtdPFhZ2dnbmU2enWkO53W2g8+4YGWSSR5bmeQsA6xx+bUxFCdBxcUml7qTejutW3vopX2+JW2steVp7nqFFFFeWaBRRRQAUUUUAFFFFABRRRQB5r8dNIl1L4o/BqaMZjsPGM9xL/unw/rMY/wDHpFr0PU9Nh1nTp7S5jWa3uo2iljbo6MCCD9QTS3OnwXk9vJNDHJJayGWFmXJicqybl9Dtdhn0YjvU1XKbkku3+bf6iscT8Df2bfAP7M/hZNF+H/g7w54O0tYoYXh0mwjtvtAhjEcZlZRulZUAG+Qs3qTk121FFKc5Tk5Td2+rHtsFFFFSAUUUUAFFFFAH/9k='\n    />\n\n    <h3 class='hr-line'>Motion Vision</h3>\n\n    <div\n      style='\n        display: flex;\n        gap: 16px;\n        flex-direction: column;\n        padding-bottom: 48px;\n      '\n    >\n      <div class='row hidden'>\n        <label> Device is : </label>\n\n        <div class='button r toggle'>\n          <input type='checkbox' class='checkbox' id='onoff' />\n          <div class='knobs' data-on='ON' data-off='OFF'></div>\n          <div class='layer'></div>\n        </div>\n      </div>\n\n      <div id='stopwatch' class='stopwatch'>\n        <div id='timer' class='timerDisplay'>00 : 00 : 00</div>\n      </div>\n\n      <h4 class='hr-line' style='margin-top: 6px'>Blur</h4>\n\n      <div class='row'>\n        <label> Bluring : </label>\n        <div class='button r toggle'>\n          <input type='checkbox' class='checkbox' id='startstop' />\n          <div class='knobs' data-on='Start' data-off='Stop'></div>\n          <div class='layer'></div>\n        </div>\n      </div>\n\n      <div class='slider'>\n        <div class='output'></div>\n        <input\n          id='range'\n          class='range'\n          type='range'\n          min='1'\n          max='10'\n          value='6'\n          step='1'\n          oninput='move(this)'\n        />\n      </div>\n\n      <div class='row'>\n        <label> Auto B : </label>\n        <div class='button r toggle'>\n          <input type='checkbox' class='checkbox' id='automanual' />\n          <div class='knobs' data-on='auto' data-off='manu'></div>\n          <div class='layer'></div>\n        </div>\n      </div>\n\n      <h4 class='hr-line' style='margin-top: 6px'>Custom Level</h4>\n\n      <div class='row'>\n        <!-- <label> Total Time: </label>\n        <input type='number' id='totalTime' class='number' /> -->\n\n        <label> Total Level: </label>\n        <input type='number' id='totalLevel' class='number' min='0' value='0' />\n      </div>\n\n      <div class='row'>\n        <label> Custom is : </label>\n        <div class='button r toggle'>\n          <input type='checkbox' class='checkbox' id='startstopCustom' />\n          <div class='knobs' data-on='Start' data-off='Stop'></div>\n          <div class='layer'></div>\n        </div>\n      </div>\n\n      <div id='container'></div>\n\n      <!-- <div class='card'>\n        <div class='row'>\n          <label> Level: </label>\n          <input type='number' class='number' />\n\n          <label> Time: </label>\n          <input type='number' class='number' min='0' value='0' />\n        </div>\n      </div> -->\n    </div>\n\n    <div id='progress' class='progress-bar hidden'>\n      <div class='progress-bar-value'></div>\n    </div>\n  </body>\n\n  <script defer>\n    function move(el) {\n      var x = el.value;\n      var ele = el.previousElementSibling;\n      ele.style.marginLeft = x * 10 - 5 + '%';\n      ele.innerHTML = +x + '';\n    }\n\n    move(range);\n\n    let controllers = {};\n    let loading = [];\n    function callApi(name, controllerName) {\n      controllers[controllerName]?.abort();\n      controllers[controllerName] = new AbortController();\n\n      let index = loading.push(true) - 1;\n\n      let promise = fetch('/' + name, {\n        signal: controllers[controllerName].signal,\n      });\n\n      promise.finally((i) => (loading[index] = false));\n\n      return promise.then((response) => response.json());\n    }\n\n    let isActive = false;\n    let isOn = true;\n    let status = 'normal';\n    let isBlur = false;\n    let isAuto = false;\n    let isCustomStart = false;\n    let interval = range.value;\n\n    onoff.onchange = () => {\n      isOn = !onoff.checked;\n      let elm = document.querySelector('.stopwatch');\n      while (elm) {\n        elm.classList[onoff.checked ? 'add' : 'remove']('hidden');\n        elm = elm.nextElementSibling;\n      }\n    };\n\n    startstop.onchange = () => {\n      isBlur = !startstop.checked;\n      isAuto = false;\n      isCustomStart = false;\n\n      const reponse = callApi(isBlur ? 'glassOn' : 'glassOff', 'onoff').then(\n        (i) => (isActive = isBlur)\n      );\n\n      restartTimer();\n    };\n\n    // let _autoTimer = null;\n    // function startAutoTimer() {\n    //   clearInterval(_autoTimer);\n\n    //   //1000 / 6 / 2\n    //   let time = 500 / interval;\n    //   _autoTimer = setInterval(() => {\n    //     if (status != 'auto') return clearInterval(_autoTimer);\n    //     isActive = !isActive;\n    //   }, time);\n    // }\n\n    automanual.onchange = () => {\n      isAuto = !automanual.checked;\n      isBlur = false;\n      isCustomStart = false;\n\n      //run timer\n      const reponse = callApi(\n        isAuto ? 'glassOnTimer' : 'glassOffTimer',\n        'onoff'\n      ).then((i) => {\n        isActive = !isActive;\n        startAutoTimer();\n      });\n\n      restartTimer();\n    };\n\n    let _customTimer = null;\n    let _customLevel = 0;\n    let _customMiliSeconds = 0;\n    function startCustomTimer() {\n      clearInterval(_customTimer);\n\n      _customLevel = 0;\n      _customMiliSeconds = 0;\n      container\n        .querySelectorAll('.card')\n        .forEach((i) => i.classList.remove('active'));\n\n      if (!isCustomStart) return;\n\n      const activeNumber = (level) => {\n        container\n          .querySelectorAll('.card')\n          .forEach((i) => i.classList.remove('active'));\n        container.querySelectorAll('.card')[level].classList.add('active');\n        let isCheck = container.querySelectorAll(`input[type='checkbox']`)[\n          level\n        ].checked;\n        const reponse = callApi(\n          !isCheck ? 'glassOn' : 'glassOff',\n          'custom'\n        ).then((i) => {\n          isActive = !isActive;\n        });\n      };\n\n      activeNumber(0);\n\n      _customTimer = setInterval(() => {\n        if (status != 'custom') return clearInterval(_customTimer);\n        _customMiliSeconds += 100;\n\n        let lastLevel = _customLevel;\n        let lastVal = 0;\n\n        _customLevel = Array.from(\n          container.querySelectorAll(`input[type='number']`)\n        )\n          .map((i) => (lastVal = lastVal + +i.value * 1000))\n          .findIndex((i) => i > _customMiliSeconds);\n\n        if (_customLevel == -1) {\n          _customLevel = 0;\n          _customMiliSeconds = 0;\n        }\n\n        if (lastLevel !== _customLevel) activeNumber(_customLevel);\n      }, 100);\n    }\n\n    startstopCustom.onchange = () => {\n      isCustomStart = !startstopCustom.checked;\n      isBlur = false;\n      isAuto = false;\n\n      startCustomTimer();\n      restartTimer();\n    };\n\n    let _changeRangeTimoutId;\n    let _changeRangeController;\n    range.onchange = () => {\n      interval = range.value;\n      move(range);\n\n      //call fetch\n      clearTimeout(_changeRangeTimoutId);\n      let timeoutId = (_changeRangeTimoutId = setTimeout(async () => {\n        const reponse = await callApi(\n          'setInterval?value=' + parseInt(500 / +interval),\n          'setInterval'\n        );\n        startAutoTimer();\n      }, 479));\n    };\n\n    let _wasActive = false;\n    let _isLoading = false;\n    function render() {\n      onoff.checked = !isOn;\n      startstop.checked = !isBlur;\n      automanual.checked = !isAuto;\n      startstopCustom.checked = !isCustomStart;\n\n      if (isCustomStart || isAuto || isBlur) {\n        if (isCustomStart) status = 'custom';\n        if (isAuto) status = 'auto';\n        if (isBlur) status = 'blur';\n      } else {\n        status = 'normal';\n      }\n\n      let timerStarted = !!_timerIntervalId;\n      if (!timerStarted && status != 'normal') startTimer();\n      if (timerStarted && status == 'normal') stopTimer();\n\n      if (_wasActive !== isActive) {\n        _wasActive = isActive;\n        stopwatch.style.background = isActive ? '#4fd93e' : '';\n      }\n\n      if (_isLoading != loading.some((i) => i)) {\n        _isLoading = loading.some((i) => i);\n        progress.classList[_isLoading ? 'remove' : 'add']('hidden');\n      }\n      // range.value = +interval;\n      requestAnimationFrame((i) => requestAnimationFrame((i) => render()));\n    }\n\n    requestAnimationFrame((i) => requestAnimationFrame((i) => render()));\n\n    let totalLevelOninput = () => {\n      let level = totalLevel.value;\n      level = level <= 0 ? 0 : level;\n      startstopCustom.disabled = level <= 0;\n      if (level <= 0) startstopCustom.checked = true;\n\n      let cards = document.querySelectorAll('.card');\n      if (cards.length <= level) {\n        for (let i = 0; i < level - cards.length; i++) {\n          let lastCheck = container.querySelector(\n            `.card:last-of-type input[type='checkbox']`\n          )?.checked;\n\n          container.insertAdjacentHTML(\n            'beforeend',\n            `<div class='card'> <div class='row'> <label> Time: </label> <input type='number' class='number' value='1'/> <div class='row'>  <label> ON / OFF : </label>  <div class='button r toggle'> <input type='checkbox' class='checkbox' ${\n              !lastCheck ? ' checked ' : ''\n            }/>  <div class='knobs' data-on='ON' data-off='OFF'></div>  <div class='layer'></div>  </div>  </div> </div> </div>`\n          );\n        }\n      } else {\n        cards.forEach((div, index) => {\n          if (index >= level) {\n            div.remove();\n          }\n        });\n      }\n    };\n\n    totalLevel.oninput = totalLevelOninput;\n    totalLevelOninput();\n\n    //timer\n    let seconds = 0;\n    let _timerIntervalId;\n\n    function startTimer() {\n      _timerIntervalId = setInterval(() => {\n        seconds++;\n        const hours = String(Math.floor(seconds / 3600)).padStart(2, '0');\n        const minutes = String(Math.floor((seconds % 3600) / 60)).padStart(\n          2,\n          '0'\n        );\n        const secs = String(seconds % 60).padStart(2, '0');\n        timer.innerText = `${hours} : ${minutes} : ${secs}`;\n      }, 10);\n    }\n\n    function stopTimer() {\n      clearInterval(_timerIntervalId);\n      _timerIntervalId = null;\n    }\n\n    function restartTimer() {\n      seconds = 0;\n    }\n\n    stopwatch.onclick = restartTimer;\n  </script>\n</html>\n";
  return ptr;
}